{"version":3,"sources":["../src/Page.js"],"names":["timeoutWdio","require","config","waitforTimeout","Page","baseUrl","urlPath","undefined","startsWith","Error","url","constructor","name","timeout","log","logRichMessagesWithScreenshot","text","style","emoji","verb","object","selector","browser","indicatorSelector","indicatorElement","UiElement","isExisting","initialIndicatorElementHtml","getHtml","filler","AquiferFunctionalPersister","setGoal","failfastWithMessage","start","load","timeoutInMillis","succeeded","initTime","Date","getTime","err","UiContainer"],"mappings":"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","sourcesContent":["// @ts-check\nimport { UiContainer } from './UiContainer';\nimport { UiElement } from './UiElement';\nimport { log } from './AquiferLog';\nimport { AquiferFunctionalPersister } from './AquiferFunctionalPersister';\n\nconst timeoutWdio = require('../wdio-conf/wdio.conf').config.waitforTimeout;\n\n/** Parent class for specific page objects. */\nexport class Page extends UiContainer {\n  constructor(baseUrl, urlPath = undefined) {\n    if (urlPath && !urlPath.startsWith('/')) {\n      throw new Error('urlPath should start with forward slash (/)');\n    }\n    super();\n    this.url = baseUrl + (urlPath || '');\n    super.setName(this.constructor.name);\n  }\n\n  setUrl(url) {\n    this.url = url;\n    return this;\n  }\n\n  static load(url) {\n    log.logRichMessagesWithScreenshot([\n      { text: 'ðŸ•¸  ', style: log.style.emoji },\n      { text: 'Load ', style: log.style.verb },\n      { text: url, style: log.style.selector }]);\n\n    browser.url(url);\n  }\n\n  load(timeout = timeoutWdio) {\n    log.logRichMessagesWithScreenshot([\n      { text: 'ðŸ•¸  ', style: log.style.emoji },\n      { text: 'Load ', style: log.style.verb },\n      { text: `${this.name} Page `, style: log.style.object },\n      { text: this.url, style: log.style.selector }]);\n\n    browser.url(this.url);\n    return super.waitForLoad(timeout);\n  }\n\n  load_waitForChange(indicatorSelector = '//body', timeout = timeoutWdio) {\n    const indicatorElement = new UiElement(indicatorSelector);\n\n    if (indicatorElement.isExisting()) {\n      const initialIndicatorElementHtml = indicatorElement.getHtml();\n\n\n      log.logRichMessagesWithScreenshot([\n        { text: 'ðŸ•¸  ', style: log.style.emoji },\n        { text: 'Load ', style: log.style.verb },\n        { text: `${this.name} Page `, style: log.style.object },\n        { text: this.url, style: log.style.selector },\n        { text: ' then wait for change in ', style: log.style.filler },\n        { text: indicatorSelector, style: log.style.selector },\n        { text: ' target: ', style: log.style.filler },\n        { text: `${indicatorSelector} `, style: log.style.selector }]);\n\n      browser.url(this.url);\n\n      new AquiferFunctionalPersister(timeout)\n        .setGoal(() => indicatorElement.getHtml() !== initialIndicatorElementHtml)\n        .failfastWithMessage(`timeout waiting for ${indicatorSelector} to change after loading ${this.name}`)\n        .start();\n      return super.waitForLoad(timeout);\n    }\n\n    return this.load(timeout);\n  }\n\n\n  loadWithRetry(timeoutInMillis = timeoutWdio * 5) {\n    let succeeded = false;\n\n    const initTime = new Date().getTime();\n\n    while (!succeeded && new Date().getTime() - initTime < timeoutInMillis) {\n      try {\n        this.load();\n        succeeded = true;\n      } catch (err) { /* do nothing */ }\n    }\n  }\n\n  /* eslint class-methods-use-this: \"off\" */\n  get(selector) {\n    return new UiElement(selector);\n  }\n}\n"],"file":"Page.js"}