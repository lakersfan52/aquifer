{"version":3,"sources":["../src/UiContainer.js"],"names":["timeoutWdio","require","config","waitforTimeout","UiContainer","constructor","TypeError","propName","propValue","setName","err","name","stuartname","timeout","i","criteriaElements","length","element","waitForExist","error","Error","waitForLoad","getWebElement","selector","$$","$","excludedElements","misMatchTolerance","global","aquiferOptions","resetReferenceImages","doDeleteReferenceImage","waitFor","forEach","uiElement","waitForVisible","excludedSelectors","map","log","screenshotTargetName","screenshotTargetSelector","JSON","stringify","succeeded","report","initTime","Date","getTime","count","doLogVisualTest","customScreenshotTag","filenamify","browser","checkElement","hide","checkDocument","isWithinMisMatchTolerance","sleep","logFailedVisualTest","previousImageFileLocation","aVisualTestFailed","undefined","checkVisual","inputObjects","doLog","outputString","push","k","n","slice","logRichMessagesWithScreenshot","text","style","emoji","verb","object","click","doLogAndWait","inputObject","j","keys","pause","abElements","isLoadCriterion"],"mappings":"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","sourcesContent":["// @ts-check\nimport { log } from './AquiferLog';\n\nconst timeoutWdio = require('../wdio-conf/wdio.conf').config.waitforTimeout;\n\n/**\n * Any class that contains custom web element objects.\n *\n * Abstract class\n */\n/* eslint guard-for-in: \"off\", no-restricted-syntax: \"off\",  */\nexport class UiContainer {\n  constructor() {\n    if (this.constructor === UiContainer) {\n      throw new TypeError('Abstract class cannot be instantiated directly.');\n    }\n  }\n\n  /* eslint guard-for-in: \"off\", no-restricted-syntax: \"off\" */\n  /**\n   * This adds a custom name parameter to each element object so that the variable's name\n   * can be displayed in the ui test logs instead of just a potentially cryptic selector.\n   *\n   * This was inspired by the idea that maybe we should avoid using visible values in selectors to prepare for multi-language support\n   */\n  nameElements() {\n    for (const propName in this) {\n      const propValue = this[propName];\n      if (propValue) {\n        try {\n          // @ts-ignore\n          propValue.setName(propName);\n        } catch (err) {\n          // do nothing. love to check if propValue was instanceOf UiElement but that requires circular dependency\n        }\n      }\n    }\n  }\n\n  setName(name) {\n    this.stuartname = name;\n    return this;\n  }\n\n  get name() { return this.stuartname; }\n\n  get criteriaElements() {\n    const abElements = [];\n\n    for (const propName in this) {\n      const propValue = this[propName];\n      try {\n        // @ts-ignore\n        if (propValue.isLoadCriterion) { // propValue instanceof UiElement &&\n          abElements.push(propValue);\n        }\n      } catch (err) {\n        // do nothing.  i would love to check if propValue was instanceOf UiElement but that gives circular dependency errors\n      }\n    }\n    return abElements;\n  }\n\n  waitForLoad(timeout = timeoutWdio) {\n    try {\n      for (let i = 0; i < this.criteriaElements.length; i++) {\n        const element = this.criteriaElements[i];\n        // @ts-ignore\n        element.waitForExist(timeout);\n      }\n    } catch (error) {\n      throw new Error(`An element in ${this.constructor.name} failed to load within ${timeout} ms. ${error}`);\n    }\n    return this;\n  }\n\n  waitFor(timeout = timeoutWdio) {\n    // @ts-ignore\n    if (this.waitForExist) {\n      // @ts-ignore\n      this.waitForExist(timeout);\n    }\n    return this.waitForLoad(timeout);\n  }\n\n  isLoaded(timeout = timeoutWdio) {\n    for (let i = 0; i < this.criteriaElements.length; i++) {\n      const element = this.criteriaElements[i];\n      // @ts-ignore\n      element.getWebElement(timeout);\n    }\n    return true;\n  }\n\n  /* eslint class-methods-use-this: \"off\" */\n  findWebElements(selector) {\n    return $$(selector);\n  }\n\n  /* eslint class-methods-use-this: \"off\" */\n  findWebElement(selector) {\n    return $(selector);\n  }\n\n  /**\n   * Asserts that the browser screen matches the screenshot saved in screenshots/reference.\n   *\n   * To reset the reference image, replace `checkVisual(...)` with `resetVisual(...)` and re-run.\n   * @param  excludedElements UiElement - cssSelectors or xpaths for sections of the screen to ignore\n   */\n  checkVisual({ excludedElements = [], misMatchTolerance = 0.05 } = { excludedElements: [], misMatchTolerance: 0.05 }) {\n    if (global.aquiferOptions.resetReferenceImages) {\n      global.doDeleteReferenceImage = true;\n    }\n\n    this.waitFor();\n    excludedElements.forEach((uiElement) => {\n      uiElement.waitForVisible();\n    });\n\n    const excludedSelectors = excludedElements.map(uiElement => uiElement.selector);\n\n    log.screenshotTargetName = this.name;\n    log.screenshotTargetSelector = excludedSelectors.length > 0 ? ` excluding: ${JSON.stringify(excludedSelectors)}` : '';\n\n    let succeeded = false;\n\n    let report;\n\n    const initTime = new Date().getTime();\n\n    let count = 0;\n\n    while (!succeeded && new Date().getTime() - initTime < timeoutWdio) {\n      global.doLogVisualTest = count === 0;\n      // @ts-ignore\n      if (this.selector) {\n        /* is an element */\n        // @ts-ignore\n        global.customScreenshotTag = global.filenamify(this.selector);\n\n        /* eslint prefer-destructuring: \"off\" */\n        // @ts-ignore\n        report = browser.checkElement(this.selector, { hide: excludedSelectors, misMatchTolerance })[0];\n      } else {\n        /* is a page */\n\n        global.customScreenshotTag = global.filenamify(`${this.constructor.name}Page`);\n\n        /* eslint prefer-destructuring: \"off\" */\n        // @ts-ignore\n        report = browser.checkDocument({ hide: excludedSelectors, misMatchTolerance })[0];\n      }\n      succeeded = report.isWithinMisMatchTolerance;\n      if (!succeeded) {\n        this.sleep(2000);\n      }\n      count += 1;\n    }\n\n    if (!report.isWithinMisMatchTolerance) {\n      log.logFailedVisualTest(global.previousImageFileLocation, report);\n      log.aVisualTestFailed = true;\n    }\n    global.customScreenshotTag = undefined;\n    log.screenshotTargetName = undefined;\n    log.screenshotTargetSelector = undefined;\n  }\n\n  resetVisual({ excludedElements = [], misMatchTolerance }) {\n    // this is sloppy but i'm not sure how else to determine the ref image name - stuart 11/22/2018\n    global.doDeleteReferenceImage = true;\n    this.checkVisual({ excludedElements, misMatchTolerance });\n    global.doDeleteReferenceImage = false;\n  }\n\n  /**\n   * if input is a single array, the elements will be typed consecutively.\n   *\n   * if input is a list of values, the first value is a key to type (k), and the next value is how many times to type it (n), as in\n   *\n   * keys(k1, n1, k2, n2)\n   *\n   * if the last \"n\" value is missing, it's assumed to be 1.\n   *\n   * if last element is \"false\", then each key won't be logged\n   * @param  {...any} inputs\n   */\n  keys(...inputs) {\n    try {\n      this.waitFor();\n    } catch { /* do nothing */ } finally { /* do nothing */ }\n\n    const inputObjects = [];\n\n    let doLog = true;\n\n    let outputString = '';\n\n    if (inputs.length === 1) {\n      inputObjects.push({ k: inputs[0], n: 1 });\n      outputString = JSON.stringify(inputObjects[0].k);\n    } else {\n      for (let i = 0; i < inputs.length; i += 2) {\n        const k = inputs[i];\n\n        if (i + 1 < inputs.length) {\n          const n = inputs[i + 1];\n\n          inputObjects.push({ k, n });\n          outputString += `${JSON.stringify(k) + (n > 1 ? `x${n}` : '')}, `;\n        } else {\n          doLog = k;\n        }\n      }\n      outputString = outputString.slice(0, -2);\n    }\n\n    if (doLog) {\n      log.logRichMessagesWithScreenshot([\n        { text: '⌨  ', style: log.style.emoji },\n        { text: 'Type ', style: log.style.verb },\n        { text: outputString, style: log.style.object }]);\n    }\n\n    this.waitFor();\n    // @ts-ignore\n    this.click && this.click({ doLogAndWait: false });\n\n    for (let i = 0; i < inputObjects.length; i++) {\n      const inputObject = inputObjects[i];\n      for (let j = 0; j < inputObject.n; j++) {\n        browser.keys(inputObject.k);\n      }\n    }\n  }\n\n  sleep(timeout = timeoutWdio) {\n    this.waitForLoad(timeout);\n    browser.pause(timeout);\n  }\n}\n"],"file":"UiContainer.js"}